version: '3.8'

services:
  # LocalStack for AWS services (DynamoDB, SES, Secrets Manager)
  localstack:
    image: localstack/localstack:latest
    container_name: agentic-pm-localstack
    ports:
      - '4566:4566'
    environment:
      - SERVICES=dynamodb,ses,secretsmanager
      - DEBUG=0
      - DATA_DIR=/var/lib/localstack/data
    volumes:
      - localstack-data:/var/lib/localstack
    healthcheck:
      test: ['CMD', 'curl', '-f', 'http://localhost:4566/_localstack/health']
      interval: 10s
      timeout: 5s
      retries: 3

  # DynamoDB Admin UI (connects to LocalStack DynamoDB on port 4566)
  dynamodb-admin:
    image: aaronshaf/dynamodb-admin:latest
    container_name: agentic-pm-dynamodb-admin
    ports:
      - '8001:8001'
    environment:
      - DYNAMO_ENDPOINT=http://localstack:4566
      - AWS_REGION=ap-southeast-2
      - AWS_ACCESS_KEY_ID=test
      - AWS_SECRET_ACCESS_KEY=test
    depends_on:
      localstack:
        condition: service_healthy

  # MailHog for email testing
  mailhog:
    image: mailhog/mailhog:latest
    container_name: agentic-pm-mailhog
    ports:
      - '1025:1025' # SMTP
      - '8025:8025' # Web UI

volumes:
  localstack-data:
